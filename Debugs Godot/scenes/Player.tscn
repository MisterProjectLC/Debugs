[gd_scene load_steps=9 format=3 uid="uid://do2vd2b8ug270"]

[ext_resource type="Texture2D" uid="uid://040q2i5fa7it" path="res://sprites/player/armado - player - costa.png" id="1_2xpmy"]
[ext_resource type="Texture2D" uid="uid://bslkot7qeiip3" path="res://sprites/player/armado - player - dir.png" id="2_uutdq"]
[ext_resource type="Texture2D" uid="uid://c0m4x32kkf6x1" path="res://sprites/player/armado - player - esq.png" id="3_cfalf"]
[ext_resource type="Texture2D" uid="uid://cl2l6cgtoxnyc" path="res://sprites/player/armado - player - frente .png" id="4_lo08f"]

[sub_resource type="GDScript" id="GDScript_ycven"]
script/source = "extends Area2D

@export var speed = 400 
var screen_size
var bullet_speed = 1500
var bullet = preload(\"res://scenes/Bullet.tscn\")
var can_fire = true

func _ready():
	screen_size = get_viewport_rect().size
	
func _process(delta):
	var velocity = Vector2.ZERO 
	if Input.is_action_pressed(\"move_right\"):
		velocity.x += 1
	if Input.is_action_pressed(\"move_left\"):
		velocity.x -= 1   
	if Input.is_action_pressed(\"move_down\"):
		velocity.y += 1  
	if Input.is_action_pressed(\"move_up\"):
		velocity.y -= 1
	if Input.is_action_pressed(\"fire\") and can_fire: 
		fire()

	if velocity.length() > 0:
		velocity = velocity.normalized() * speed
		$AnimatedSprite2D.play()
	else:
		$AnimatedSprite2D.stop()
	
	position += velocity * delta
	position.x = clamp(position.x, 0, screen_size.x)
	position.y = clamp(position.y, 0, screen_size.y)
	look_at(get_global_mouse_position())
	
	
func fire():
	can_fire = false
	var bullet_intance = bullet.instantiate()
	bullet_intance.position = get_global_position()
	bullet_intance.rotation_degrees = rotation_degrees
	bullet_intance.apply_central_impulse(Vector2(bullet_speed,0).rotated(rotation))
	get_tree().get_root().call_deferred(\"add_child\",bullet_intance)
	$Timer.start()

func _on_timer_timeout():
	can_fire = true
	
func kill():
	get_tree().reload_current_scene()

func _on_area_2d_body_entered(body):
	if \"enemy\" in body.name:
		kill()
	
	
func start(pos):
	position = pos
	show()
	$CollisionShape2D.disabled = false
	


	
"

[sub_resource type="SpriteFrames" id="SpriteFrames_07kvn"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": ExtResource("1_2xpmy")
}],
"loop": true,
"name": &"costa",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("2_uutdq")
}],
"loop": true,
"name": &"dir",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("3_cfalf")
}],
"loop": true,
"name": &"esq",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("4_lo08f")
}],
"loop": true,
"name": &"frente",
"speed": 5.0
}]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_wbpci"]
size = Vector2(22, 96)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_75q46"]
size = Vector2(37, 108)

[node name="player" type="Area2D"]
position = Vector2(960, 540)
script = SubResource("GDScript_ycven")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
scale = Vector2(3, 3)
sprite_frames = SubResource("SpriteFrames_07kvn")
animation = &"dir"

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(-5, 0)
shape = SubResource("RectangleShape2D_wbpci")

[node name="Area2D" type="Area2D" parent="."]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Area2D"]
position = Vector2(-4.5, 1)
shape = SubResource("RectangleShape2D_75q46")

[node name="Timer" type="Timer" parent="."]
wait_time = 0.33

[connection signal="body_entered" from="Area2D" to="." method="_on_area_2d_body_entered"]
[connection signal="timeout" from="Timer" to="." method="_on_timer_timeout"]
